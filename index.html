<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚ùÑÔ∏è Barf Malai - Premium Ice Cream</title>
    <style>
        <?!= include('style.css'); ?>
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <h1>‚ùÑÔ∏è Barf Malai</h1>
                    <p>Premium Ice Cream Delights</p>
                </div>
                <div class="header-actions">
                    <div class="search-bar">
                        <input type="text" id="searchInput" placeholder="Search ice creams..." class="search-input">
                    </div>
                    <button class="cart-btn" onclick="toggleCart()">
                        üõí Cart <span id="cartCount">0</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main">
        <div class="container">
            <!-- Categories Section -->
            <section class="categories-section">
                <h2 class="section-title">Our Categories</h2>
                <div class="categories-grid" id="categoriesGrid">
                    <!-- Categories will be loaded here -->
                </div>
            </section>

            <!-- Products Section -->
            <section class="products-section">
                <h2 class="section-title" id="productsTitle">All Products</h2>
                <div class="products-grid" id="productsGrid">
                    <!-- Products will be loaded here -->
                </div>
            </section>
        </div>
    </main>

    <!-- Cart Sidebar -->
    <div class="cart-sidebar" id="cartSidebar">
        <div class="cart-header">
            <h3>Your Order</h3>
            <button class="close-cart" onclick="toggleCart()">√ó</button>
        </div>
        <div class="cart-items" id="cartItems">
            <!-- Cart items will be loaded here -->
        </div>
        <div class="cart-footer">
            <div class="cart-total">
                <strong>Total: ‚Çπ<span id="cartTotal">0</span></strong>
            </div>
            <button class="btn btn-primary btn-checkout" onclick="showCheckoutForm()">
                Proceed to Checkout
            </button>
        </div>
    </div>

    <!-- Checkout Form Modal -->
    <div class="modal" id="checkoutModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Complete Your Order</h3>
                <button class="close-modal" onclick="closeCheckoutForm()">√ó</button>
            </div>
            <form id="checkoutForm" onsubmit="placeOrder(event)">
                <div class="form-group">
                    <label>Full Name *</label>
                    <input type="text" id="customerName" required class="form-input">
                </div>
                <div class="form-group">
                    <label>Phone Number *</label>
                    <input type="tel" id="customerPhone" required class="form-input">
                </div>
                <div class="form-group">
                    <label>Email (Optional)</label>
                    <input type="email" id="customerEmail" class="form-input">
                </div>
                <div class="form-group">
                    <label>Special Instructions</label>
                    <textarea id="customerNote" class="form-input" rows="3" placeholder="Any special requests or delivery instructions..."></textarea>
                </div>
                <div class="order-summary">
                    <h4>Order Summary</h4>
                    <div id="orderSummary">
                        <!-- Order summary will be loaded here -->
                    </div>
                    <div class="order-total">
                        <strong>Total: ‚Çπ<span id="orderTotal">0</span></strong>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary btn-block">
                    Place Order
                </button>
            </form>
        </div>
    </div>

    <!-- Success Toast -->
    <div class="toast" id="successToast">
        <div class="toast-content">
            <span class="toast-icon">‚úÖ</span>
            <span class="toast-message" id="toastMessage">Order placed successfully!</span>
        </div>
    </div>

    <!-- Overlay -->
    <div class="overlay" id="overlay" onclick="toggleCart(); closeCheckoutForm();"></div>

    <script>
        <?!= include('script.js'); ?>
        
        // User-specific JavaScript
        let currentCategory = 'all';
        
        // Load categories and products on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadCategories();
            loadProducts();
            
            // Load cart from localStorage
            loadCart();
        });
        
        function loadCategories() {
            google.script.run
                .withSuccessHandler(displayCategories)
                .withFailureHandler(showError)
                .getCategories();
        }
        
        function displayCategories(categories) {
            const categoriesGrid = document.getElementById('categoriesGrid');
            
            categoriesGrid.innerHTML = categories.map(category => `
                <div class="category-card" onclick="filterByCategory('${category.name}')">
                    <div class="category-image">
                        <img src="${category.imageUrl}" alt="${category.name}">
                    </div>
                    <div class="category-name">${category.name}</div>
                </div>
            `).join('');
        }
        
        function loadProducts(category = 'all') {
            google.script.run
                .withSuccessHandler(products => displayProducts(products, category))
                .withFailureHandler(showError)
                .getProducts();
        }
        
        function displayProducts(products, category) {
            const productsGrid = document.getElementById('productsGrid');
            const productsTitle = document.getElementById('productsTitle');
            
            // Update title
            if (category === 'all') {
                productsTitle.textContent = 'All Products';
            } else {
                productsTitle.textContent = category;
            }
            
            // Filter products if category is specified
            let filteredProducts = products;
            if (category !== 'all') {
                filteredProducts = products.filter(product => product.category === category);
            }
            
            if (filteredProducts.length > 0) {
                productsGrid.innerHTML = filteredProducts.map(product => `
                    <div class="product-card">
                        <div class="product-image">
                            <img src="${product.imageUrl}" alt="${product.name}">
                        </div>
                        <div class="product-info">
                            <h3 class="product-name">${product.name}</h3>
                            <p class="product-description">${product.description || 'Delicious ice cream treat'}</p>
                            <div class="product-footer">
                                <span class="product-price">‚Çπ${product.price}</span>
                                <button class="btn btn-primary btn-sm" onclick="addToCart('${product.id}', '${product.name}', ${product.price}, '${product.imageUrl}')">
                                    Add to Cart
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            } else {
                productsGrid.innerHTML = `
                    <div class="empty-state">
                        <h3>No products found</h3>
                        <p>Try selecting a different category</p>
                    </div>
                `;
            }
        }
        
        function filterByCategory(categoryName) {
            currentCategory = categoryName;
            loadProducts(categoryName);
            
            // Update UI to show active category
            document.querySelectorAll('.category-card').forEach(card => {
                card.classList.remove('active');
            });
            event.target.closest('.category-card').classList.add('active');
        }
        
        // Search functionality
        document.getElementById('searchInput').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const productCards = document.querySelectorAll('.product-card');
            
            productCards.forEach(card => {
                const productName = card.querySelector('.product-name').textContent.toLowerCase();
                if (productName.includes(searchTerm)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        });
        
        // Show success toast
        function showToast(message) {
            const toast = document.getElementById('successToast');
            const toastMessage = document.getElementById('toastMessage');
            
            toastMessage.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
    </script>
</body>
</html>
